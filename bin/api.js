/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// object to store loaded chunks
/******/ 	// "0" means "already loaded"
/******/ 	var installedChunks = {
/******/ 		"app": 0
/******/ 	};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/ 	// The chunk loading function for additional chunks
/******/ 	// Since all referenced chunks are already included
/******/ 	// in this file, this function is empty here.
/******/ 	__webpack_require__.e = function requireEnsure() {
/******/ 		return Promise.resolve();
/******/ 	};
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// uncaught error handler for webpack runtime
/******/ 	__webpack_require__.oe = function(err) {
/******/ 		process.nextTick(function() {
/******/ 			throw err; // catch this error by using import().catch()
/******/ 		});
/******/ 	};
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./shared/api/api.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./etc/secure.json":
/*!*************************!*\
  !*** ./etc/secure.json ***!
  \*************************/
/*! exports provided: secret, authTokenExpiresIn, mongo, apiServer, webServer, originCORS, trustProxy, development, loglevel, default */
/***/ (function(module) {

eval("module.exports = JSON.parse(\"{\\\"secret\\\":\\\"79a947c3cbecfb5819b03f21eb00b3180e649bea0c189a7f4ff0bdd10e1fd292\\\",\\\"authTokenExpiresIn\\\":\\\"7 days\\\",\\\"mongo\\\":{\\\"url\\\":\\\"mongodb://localhost:27017\\\",\\\"dbName\\\":\\\"zoia\\\"},\\\"apiServer\\\":{\\\"ip\\\":\\\"127.0.0.1\\\",\\\"port\\\":3000},\\\"webServer\\\":{\\\"ip\\\":\\\"127.0.0.1\\\",\\\"port\\\":3001},\\\"originCORS\\\":\\\"*\\\",\\\"trustProxy\\\":true,\\\"development\\\":false,\\\"loglevel\\\":\\\"info\\\"}\");\n\n//# sourceURL=webpack:///./etc/secure.json?");

/***/ }),

/***/ "./modules lazy recursive ^\\.\\/.*\\/api\\/index\\.js$":
/*!****************************************************************!*\
  !*** ./modules lazy ^\.\/.*\/api\/index\.js$ namespace object ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var map = {\n\t\"./admin/api/index.js\": [\n\t\t\"./modules/admin/api/index.js\",\n\t\t\"app\"\n\t],\n\t\"./pages/api/index.js\": [\n\t\t\"./modules/pages/api/index.js\",\n\t\t\"app\"\n\t],\n\t\"./registry/api/index.js\": [\n\t\t\"./modules/registry/api/index.js\",\n\t\t\"app\"\n\t],\n\t\"./users/api/index.js\": [\n\t\t\"./modules/users/api/index.js\",\n\t\t\"app\"\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = \"./modules lazy recursive ^\\\\.\\\\/.*\\\\/api\\\\/index\\\\.js$\";\nmodule.exports = webpackAsyncContext;\n\n//# sourceURL=webpack:///./modules_lazy_^\\.\\/.*\\/api\\/index\\.js$_namespace_object?");

/***/ }),

/***/ "./modules/admin/api/index.js":
/*!************************************!*\
  !*** ./modules/admin/api/index.js ***!
  \************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony default export */ __webpack_exports__[\"default\"] = (function () {});\n\n//# sourceURL=webpack:///./modules/admin/api/index.js?");

/***/ }),

/***/ "./modules/pages/api/apiLoadFolderTree.js":
/*!************************************************!*\
  !*** ./modules/pages/api/apiLoadFolderTree.js ***!
  \************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _shared_lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../shared/lib/auth */ \"./shared/lib/auth.js\");\n\n\n\n/* eslint no-param-reassign:0 */\n\n\nvar loop = function loop(data, callback) {\n  data.forEach(function (item, index, arr) {\n    callback(item, index, arr);\n\n    if (item.children) {\n      loop(item.children, callback);\n    }\n  });\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  return {\n    schema: {\n      body: {\n        type: 'object',\n        properties: {\n          token: {\n            type: 'string'\n          },\n          language: {\n            type: 'string',\n            minLength: 2,\n            maxLength: 2\n          }\n        },\n        required: ['token', 'language']\n      }\n    },\n    attachValidation: true,\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        var user, folderTree, folders;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.validationError) {\n                  _context.next = 3;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: req.validationError.message\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify(req.validationError)));\n\n              case 3:\n                _context.next = 5;\n                return _shared_lib_auth__WEBPACK_IMPORTED_MODULE_2__[\"default\"].verifyToken(req.body.token, fastify, this.mongo.db);\n\n              case 5:\n                user = _context.sent;\n\n                if (!(!user || !user.admin)) {\n                  _context.next = 9;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: 'Authentication failed'\n                });\n                return _context.abrupt(\"return\", rep.code(403).send(JSON.stringify({\n                  statusCode: 403,\n                  error: 'Authentication failed'\n                })));\n\n              case 9:\n                _context.prev = 9;\n                _context.next = 12;\n                return this.mongo.db.collection('registry').findOne({\n                  _id: 'pages_folder_tree'\n                });\n\n              case 12:\n                folderTree = _context.sent;\n                folders = folderTree ? folderTree.data || [] : [];\n                loop(folders, function (item) {\n                  var defaultTitle = item.data[Object.keys(item.data)[0]].title;\n                  var title = item.data[req.body.language] ? item.data[req.body.language].title || defaultTitle : defaultTitle;\n                  item.title = title;\n                }); // Send response\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200,\n                  data: folders\n                })));\n\n              case 18:\n                _context.prev = 18;\n                _context.t0 = _context[\"catch\"](9);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t0\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t0.message\n                })));\n\n              case 22:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[9, 18]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/pages/api/apiLoadFolderTree.js?");

/***/ }),

/***/ "./modules/pages/api/apiPageLoad.js":
/*!******************************************!*\
  !*** ./modules/pages/api/apiPageLoad.js ***!
  \******************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _shared_lib_auth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../shared/lib/auth */ \"./shared/lib/auth.js\");\n\n\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  return {\n    schema: {\n      body: {\n        type: 'object',\n        properties: {\n          token: {\n            type: 'string'\n          },\n          id: {\n            type: 'string',\n            minLength: 24,\n            maxLength: 24,\n            pattern: '^[a-f0-9]+$'\n          }\n        },\n        required: ['token', 'id']\n      }\n    },\n    attachValidation: true,\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        var user, pageRecord;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.validationError) {\n                  _context.next = 3;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: req.validationError.message\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify(req.validationError)));\n\n              case 3:\n                _context.next = 5;\n                return _shared_lib_auth__WEBPACK_IMPORTED_MODULE_3__[\"default\"].verifyToken(req.body.token, fastify, this.mongo.db);\n\n              case 5:\n                user = _context.sent;\n\n                if (!(!user || !user.admin)) {\n                  _context.next = 9;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: 'Authentication failed'\n                });\n                return _context.abrupt(\"return\", rep.code(403).send(JSON.stringify({\n                  statusCode: 403,\n                  error: 'Authentication failed'\n                })));\n\n              case 9:\n                _context.prev = 9;\n                _context.next = 12;\n                return this.mongo.db.collection('pages').findOne({\n                  _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__[\"ObjectId\"](req.body.id)\n                });\n\n              case 12:\n                pageRecord = _context.sent;\n\n                if (pageRecord) {\n                  _context.next = 15;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify({\n                  statusCode: 400,\n                  error: 'Non-existent record'\n                })));\n\n              case 15:\n                Object.keys(pageRecord.data).map(function (language) {\n                  return pageRecord[language] = pageRecord.data[language];\n                });\n                delete pageRecord.data; // Send response\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200,\n                  data: pageRecord\n                })));\n\n              case 20:\n                _context.prev = 20;\n                _context.t0 = _context[\"catch\"](9);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t0\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t0.message\n                })));\n\n              case 24:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[9, 20]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/pages/api/apiPageLoad.js?");

/***/ }),

/***/ "./modules/pages/api/apiPageSave.js":
/*!******************************************!*\
  !*** ./modules/pages/api/apiPageSave.js ***!
  \******************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var ajv__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ajv */ \"ajv\");\n/* harmony import */ var ajv__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(ajv__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var fs_extra__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! fs-extra */ \"fs-extra\");\n/* harmony import */ var fs_extra__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(fs_extra__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _shared_lib_auth__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../shared/lib/auth */ \"./shared/lib/auth.js\");\n\n\n\n\n\n\nvar site = fs_extra__WEBPACK_IMPORTED_MODULE_4___default.a.readJSONSync(\"\".concat(__dirname, \"/../etc/site.json\"));\nvar ajv = new ajv__WEBPACK_IMPORTED_MODULE_2___default.a();\nvar formValidate = ajv.compile({\n  type: 'object',\n  properties: {\n    path: {\n      type: 'string',\n      maxLength: 128\n    },\n    filename: {\n      type: 'string',\n      maxLength: 128\n    }\n  },\n  required: ['path', 'filename']\n});\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  return {\n    schema: {\n      body: {\n        type: 'object',\n        properties: {\n          __form_data: {\n            type: 'string'\n          }\n        },\n        required: ['__form_data']\n      }\n    },\n    attachValidation: true,\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        var formData, formDataValidation, errorData, id, user, page, pageData, pathReduced, pathPopped, duplicatePageQuery, duplicatePage, update;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.validationError) {\n                  _context.next = 3;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: req.validationError.message\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify(req.validationError)));\n\n              case 3:\n                _context.prev = 3;\n                formData = JSON.parse(req.body.__form_data); // Start of Form Validation\n\n                formDataValidation = formValidate(formData);\n\n                if (!(!formDataValidation || formData.id && (typeof formData.id !== 'string' || !formData.id.match(/^[a-f0-9]+$/)))) {\n                  _context.next = 10;\n                  break;\n                }\n\n                errorData = {\n                  form: formDataValidation ? null : formValidate.errors || {\n                    error: 'General validation error'\n                  }\n                };\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: errorData\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify({\n                  statusCode: 400,\n                  error: errorData\n                })));\n\n              case 10:\n                id = formData.id || null; // End of Form Validation\n                // Check permissions\n\n                _context.next = 13;\n                return _shared_lib_auth__WEBPACK_IMPORTED_MODULE_5__[\"default\"].verifyToken(formData.token, fastify, this.mongo.db);\n\n              case 13:\n                user = _context.sent;\n\n                if (!(!user || !user.admin)) {\n                  _context.next = 17;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: 'Authentication failed'\n                });\n                return _context.abrupt(\"return\", rep.code(403).send(JSON.stringify({\n                  statusCode: 403,\n                  error: 'Authentication failed'\n                })));\n\n              case 17:\n                if (!id) {\n                  _context.next = 23;\n                  break;\n                }\n\n                _context.next = 20;\n                return this.mongo.db.collection('pages').findOne({\n                  _id: new mongodb__WEBPACK_IMPORTED_MODULE_3__[\"ObjectId\"](id)\n                });\n\n              case 20:\n                page = _context.sent;\n\n                if (page) {\n                  _context.next = 23;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 400,\n                  error: 'Page not found'\n                })));\n\n              case 23:\n                // Build JSON\n                pageData = {\n                  filename: formData.filename,\n                  path: formData.path,\n                  data: {}\n                }; // Check for duplicates\n\n                pathReduced = pageData.path.split(/\\//).slice(0, -1).join('/') || '/';\n                pathPopped = pageData.path.split(/\\//).pop() || '';\n                duplicatePageQuery = {\n                  $or: [{\n                    path: pageData.path,\n                    filename: pageData.filename\n                  }]\n                };\n\n                if (pageData.filename) {\n                  duplicatePageQuery.$or.push({\n                    path: \"\".concat(pageData.path, \"/\").concat(pageData.filename),\n                    filename: ''\n                  });\n                }\n\n                if (pathPopped && !pageData.filename) {\n                  duplicatePageQuery.$or.push({\n                    path: pathReduced,\n                    filename: pathPopped\n                  });\n                }\n\n                if (id) {\n                  duplicatePageQuery._id = {\n                    $ne: new mongodb__WEBPACK_IMPORTED_MODULE_3__[\"ObjectId\"](id)\n                  };\n                }\n\n                _context.next = 32;\n                return this.mongo.db.collection('pages').findOne(duplicatePageQuery);\n\n              case 32:\n                duplicatePage = _context.sent;\n\n                if (!duplicatePage) {\n                  _context.next = 35;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 400,\n                  errorCode: 1,\n                  error: 'Page with such path or filename already exists'\n                })));\n\n              case 35:\n                Object.keys(site.languages).map(function (language) {\n                  if (formData[language]) {\n                    pageData.data[language] = {\n                      title: formData[language].title,\n                      content: formData[language].content\n                    };\n                  }\n                }); // Update page\n\n                _context.next = 38;\n                return this.mongo.db.collection('pages').updateOne(id ? {\n                  _id: new mongodb__WEBPACK_IMPORTED_MODULE_3__[\"ObjectId\"](id)\n                } : {\n                  filename: pageData.filename,\n                  path: pageData.path\n                }, {\n                  $set: pageData\n                }, {\n                  upsert: true\n                });\n\n              case 38:\n                update = _context.sent;\n\n                if (!(!update || !update.result || !update.result.ok)) {\n                  _context.next = 41;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 400,\n                  error: 'Cannot update page record'\n                })));\n\n              case 41:\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200\n                })));\n\n              case 44:\n                _context.prev = 44;\n                _context.t0 = _context[\"catch\"](3);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t0\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t0.message\n                })));\n\n              case 48:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[3, 44]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/pages/api/apiPageSave.js?");

/***/ }),

/***/ "./modules/pages/api/apiPageView.js":
/*!******************************************!*\
  !*** ./modules/pages/api/apiPageView.js ***!
  \******************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (function () {\n  return {\n    schema: {\n      body: {\n        type: 'object',\n        properties: {\n          token: {\n            type: 'string'\n          },\n          path: {\n            type: 'string'\n          },\n          language: {\n            type: 'string',\n            minLength: 2,\n            maxLength: 2\n          }\n        },\n        required: ['path', 'language']\n      }\n    },\n    attachValidation: true,\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        var path, parts, filename, query, options, page;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.validationError) {\n                  _context.next = 3;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: req.validationError.message\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify(req.validationError)));\n\n              case 3:\n                _context.prev = 3;\n                path = req.body.path.toLowerCase().replace(/\\/$/, '') || null;\n                parts = '';\n                filename = '';\n\n                if (path) {\n                  parts = path.split(/\\//).filter(function (i) {\n                    return i.length;\n                  });\n\n                  if (parts.length) {\n                    filename = parts.pop();\n                  }\n                }\n\n                query = {\n                  $or: [{\n                    path: \"/\".concat((parts || []).join('/')),\n                    filename: filename\n                  }, {\n                    path: path,\n                    filename: ''\n                  }]\n                };\n                options = {\n                  projection: {\n                    _id: 1,\n                    path: 1,\n                    filename: 1\n                  }\n                };\n                options.projection[\"data.\".concat(req.body.language)] = 1;\n                _context.next = 13;\n                return this.mongo.db.collection('pages').findOne(query, options);\n\n              case 13:\n                page = _context.sent;\n\n                if (page) {\n                  _context.next = 16;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 404,\n                  error: 'Page not found'\n                })));\n\n              case 16:\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200,\n                  page: page\n                })));\n\n              case 19:\n                _context.prev = 19;\n                _context.t0 = _context[\"catch\"](3);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t0\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t0.message\n                })));\n\n              case 23:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[3, 19]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/pages/api/apiPageView.js?");

/***/ }),

/***/ "./modules/pages/api/apiPagesList.js":
/*!*******************************************!*\
  !*** ./modules/pages/api/apiPagesList.js ***!
  \*******************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/toConsumableArray */ \"@babel/runtime/helpers/toConsumableArray\");\n/* harmony import */ var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var fs_extra__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! fs-extra */ \"fs-extra\");\n/* harmony import */ var fs_extra__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(fs_extra__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _shared_lib_auth__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../shared/lib/auth */ \"./shared/lib/auth.js\");\n\n\n\n\n\nvar config = fs_extra__WEBPACK_IMPORTED_MODULE_3___default.a.readJSONSync(\"\".concat(__dirname, \"/../etc/config.json\"));\nvar site = fs_extra__WEBPACK_IMPORTED_MODULE_3___default.a.readJSONSync(\"\".concat(__dirname, \"/../etc/site.json\"));\nvar sortColumns = ['title', 'path'];\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  return {\n    schema: {\n      body: {\n        type: 'object',\n        properties: {\n          token: {\n            type: 'string'\n          },\n          page: {\n            type: 'integer',\n            minimum: 1,\n            maximum: 999999999\n          },\n          search: {\n            type: 'string',\n            maxLength: 64\n          },\n          sortColumn: {\n            type: 'string',\n            pattern: \"^(\".concat(sortColumns.join('|'), \")$\")\n          },\n          sortDirection: {\n            type: 'string',\n            pattern: '^(asc|desc)$'\n          },\n          language: {\n            type: 'string',\n            pattern: \"^(\".concat(Object.keys(site.languages).join('|'), \")$\")\n          }\n        },\n        required: ['token', 'page', 'sortColumn', 'sortDirection', 'language']\n      }\n    },\n    attachValidation: true,\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        var user, options, query, count, pages;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.validationError) {\n                  _context.next = 3;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: req.validationError.message\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify(req.validationError)));\n\n              case 3:\n                _context.next = 5;\n                return _shared_lib_auth__WEBPACK_IMPORTED_MODULE_4__[\"default\"].verifyToken(req.body.token, fastify, this.mongo.db);\n\n              case 5:\n                user = _context.sent;\n\n                if (!(!user || !user.admin)) {\n                  _context.next = 9;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: 'Authentication failed'\n                });\n                return _context.abrupt(\"return\", rep.code(403).send(JSON.stringify({\n                  statusCode: 403,\n                  error: 'Authentication failed'\n                })));\n\n              case 9:\n                _context.prev = 9;\n                // Get pages\n                options = {\n                  sort: {}\n                };\n                query = {};\n\n                if (req.body.search) {\n                  query.$or = [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_1___default()(Object.keys(site.languages).map(function (language) {\n                    var sr = {};\n                    sr[\"data.\".concat(language, \".title\")] = {\n                      $regex: req.body.search,\n                      $options: 'i'\n                    };\n                    return sr;\n                  })), [{\n                    path: {\n                      $regex: req.body.search,\n                      $options: 'i'\n                    }\n                  }, {\n                    filename: {\n                      $regex: req.body.search,\n                      $options: 'i'\n                    }\n                  }]);\n                }\n\n                _context.next = 15;\n                return this.mongo.db.collection('pages').find(query, options).count();\n\n              case 15:\n                count = _context.sent;\n                options.limit = config.commonItemsLimit;\n                options.skip = (req.body.page - 1) * config.commonItemsLimit;\n                options.projection = {\n                  _id: 1,\n                  path: 1,\n                  filename: 1\n                };\n                Object.keys(site.languages).map(function (language) {\n                  return options.projection[\"data.\".concat(language, \".title\")] = 1;\n                });\n                options.sort[req.body.sortColumn] = req.body.sortDirection === 'asc' ? 1 : -1;\n\n                if (req.body.sortColumn === 'path') {\n                  options.sort.filename = req.body.sortDirection === 'asc' ? 1 : -1;\n                }\n\n                _context.next = 24;\n                return this.mongo.db.collection('pages').find(query, options).toArray();\n\n              case 24:\n                _context.t0 = _context.sent;\n\n                if (_context.t0) {\n                  _context.next = 27;\n                  break;\n                }\n\n                _context.t0 = [];\n\n              case 27:\n                _context.t1 = function (p) {\n                  var page = {\n                    _id: p._id,\n                    path: \"\".concat(p.path === '/' ? '' : p.path).concat(p.filename ? \"/\".concat(p.filename) : '') || '/'\n                  };\n                  var defaultLanguage = Object.keys(site.languages)[0];\n                  page.title = p.data[req.body.language] && p.data[req.body.language].title ? p.data[req.body.language].title :  false || p.data[defaultLanguage] ? p.data[defaultLanguage].title : '';\n                  return page;\n                };\n\n                pages = _context.t0.map(_context.t1);\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200,\n                  items: pages,\n                  total: count\n                })));\n\n              case 32:\n                _context.prev = 32;\n                _context.t2 = _context[\"catch\"](9);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t2\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t2.message\n                })));\n\n              case 36:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[9, 32]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/pages/api/apiPagesList.js?");

/***/ }),

/***/ "./modules/pages/api/apiSaveFolderTree.js":
/*!************************************************!*\
  !*** ./modules/pages/api/apiSaveFolderTree.js ***!
  \************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _shared_lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../shared/lib/auth */ \"./shared/lib/auth.js\");\n\n\n\n/* eslint no-param-reassign:0 */\n\n\nvar loop = function loop(data, callback) {\n  data.forEach(function (item, index, arr) {\n    callback(item, index, arr);\n\n    if (item.children) {\n      loop(item.children, callback);\n    }\n  });\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  return {\n    schema: {\n      body: {\n        type: 'object',\n        properties: {\n          token: {\n            type: 'string'\n          },\n          folders: {\n            type: 'array'\n          }\n        },\n        required: ['token', 'folders']\n      }\n    },\n    attachValidation: true,\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        var user, update;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.validationError) {\n                  _context.next = 3;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: req.validationError.message\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify(req.validationError)));\n\n              case 3:\n                _context.next = 5;\n                return _shared_lib_auth__WEBPACK_IMPORTED_MODULE_2__[\"default\"].verifyToken(req.body.token, fastify, this.mongo.db);\n\n              case 5:\n                user = _context.sent;\n\n                if (!(!user || !user.admin)) {\n                  _context.next = 9;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: 'Authentication failed'\n                });\n                return _context.abrupt(\"return\", rep.code(403).send(JSON.stringify({\n                  statusCode: 403,\n                  error: 'Authentication failed'\n                })));\n\n              case 9:\n                _context.prev = 9;\n                // Modify tree\n                loop(req.body.folders, function (item) {\n                  return delete item.title;\n                }); // Update\n\n                _context.next = 13;\n                return this.mongo.db.collection('registry').updateOne({\n                  _id: 'pages_folder_tree'\n                }, {\n                  $set: {\n                    data: req.body.folders\n                  }\n                }, {\n                  upsert: true\n                });\n\n              case 13:\n                update = _context.sent;\n\n                if (!(!update || !update.result || !update.result.ok)) {\n                  _context.next = 16;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 400,\n                  error: 'Cannot update database record'\n                })));\n\n              case 16:\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200\n                })));\n\n              case 19:\n                _context.prev = 19;\n                _context.t0 = _context[\"catch\"](9);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t0\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t0.message\n                })));\n\n              case 23:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[9, 19]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/pages/api/apiSaveFolderTree.js?");

/***/ }),

/***/ "./modules/pages/api/apiUploadImage.js":
/*!*********************************************!*\
  !*** ./modules/pages/api/apiUploadImage.js ***!
  \*********************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var fs_extra__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs-extra */ \"fs-extra\");\n/* harmony import */ var fs_extra__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs_extra__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var uuid_v1__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! uuid/v1 */ \"uuid/v1\");\n/* harmony import */ var uuid_v1__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(uuid_v1__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var jimp__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! jimp */ \"jimp\");\n/* harmony import */ var jimp__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(jimp__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _shared_lib_auth__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../shared/lib/auth */ \"./shared/lib/auth.js\");\n\n\n\n/* eslint no-param-reassign:0 */\n\n\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  return {\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        var user, filename, img, thumbBuffer;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(!req.body.token || !req.body.upload || !Array.isArray(req.body.upload) || typeof req.body.token !== 'string')) {\n                  _context.next = 3;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: 'Missing token or file upload'\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify({\n                  statusCode: 400,\n                  error: 'Missing token or file upload'\n                })));\n\n              case 3:\n                _context.next = 5;\n                return _shared_lib_auth__WEBPACK_IMPORTED_MODULE_5__[\"default\"].verifyToken(req.body.token, fastify, this.mongo.db);\n\n              case 5:\n                user = _context.sent;\n\n                if (!(!user || !user.admin)) {\n                  _context.next = 9;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: 'Authentication failed'\n                });\n                return _context.abrupt(\"return\", rep.code(403).send(JSON.stringify({\n                  statusCode: 403,\n                  error: 'Authentication failed'\n                })));\n\n              case 9:\n                _context.prev = 9;\n                _context.next = 12;\n                return fs_extra__WEBPACK_IMPORTED_MODULE_2___default.a.ensureDir(\"\".concat(__dirname, \"/../static/uploads\"));\n\n              case 12:\n                filename = uuid_v1__WEBPACK_IMPORTED_MODULE_3___default()();\n                _context.next = 15;\n                return jimp__WEBPACK_IMPORTED_MODULE_4___default.a.read(req.body.upload[0].data);\n\n              case 15:\n                img = _context.sent;\n                _context.next = 18;\n                return img.getBufferAsync(jimp__WEBPACK_IMPORTED_MODULE_4___default.a.MIME_JPEG);\n\n              case 18:\n                thumbBuffer = _context.sent;\n                _context.next = 21;\n                return fs_extra__WEBPACK_IMPORTED_MODULE_2___default.a.writeFile(\"\".concat(__dirname, \"/../static/uploads/\").concat(filename, \".jpg\"), thumbBuffer);\n\n              case 21:\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200,\n                  url: \"/uploads/\".concat(filename, \".jpg\")\n                })));\n\n              case 24:\n                _context.prev = 24;\n                _context.t0 = _context[\"catch\"](9);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t0\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t0.message\n                })));\n\n              case 28:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[9, 24]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/pages/api/apiUploadImage.js?");

/***/ }),

/***/ "./modules/pages/api/index.js":
/*!************************************!*\
  !*** ./modules/pages/api/index.js ***!
  \************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _apiPageView__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./apiPageView */ \"./modules/pages/api/apiPageView.js\");\n/* harmony import */ var _apiPageLoad__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./apiPageLoad */ \"./modules/pages/api/apiPageLoad.js\");\n/* harmony import */ var _apiPageSave__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./apiPageSave */ \"./modules/pages/api/apiPageSave.js\");\n/* harmony import */ var _apiPagesList__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./apiPagesList */ \"./modules/pages/api/apiPagesList.js\");\n/* harmony import */ var _apiLoadFolderTree__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./apiLoadFolderTree */ \"./modules/pages/api/apiLoadFolderTree.js\");\n/* harmony import */ var _apiSaveFolderTree__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./apiSaveFolderTree */ \"./modules/pages/api/apiSaveFolderTree.js\");\n/* harmony import */ var _apiUploadImage__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./apiUploadImage */ \"./modules/pages/api/apiUploadImage.js\");\n\n\n\n\n\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  fastify.post('/api/page/view', Object(_apiPageView__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(fastify));\n  fastify.post('/api/pages/list', Object(_apiPagesList__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(fastify));\n  fastify.post('/api/pages/load', Object(_apiPageLoad__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(fastify));\n  fastify.post('/api/pages/save', Object(_apiPageSave__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(fastify));\n  fastify.post('/api/pages/folders/load', Object(_apiLoadFolderTree__WEBPACK_IMPORTED_MODULE_4__[\"default\"])(fastify));\n  fastify.post('/api/pages/folders/save', Object(_apiSaveFolderTree__WEBPACK_IMPORTED_MODULE_5__[\"default\"])(fastify));\n  fastify.post('/api/pages/image/upload', Object(_apiUploadImage__WEBPACK_IMPORTED_MODULE_6__[\"default\"])(fastify));\n});\n\n//# sourceURL=webpack:///./modules/pages/api/index.js?");

/***/ }),

/***/ "./modules/registry/api/apiLoadConfig.js":
/*!***********************************************!*\
  !*** ./modules/registry/api/apiLoadConfig.js ***!
  \***********************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var fs_extra__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs-extra */ \"fs-extra\");\n/* harmony import */ var fs_extra__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs_extra__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nvar config = fs_extra__WEBPACK_IMPORTED_MODULE_2___default.a.readJSONSync(\"\".concat(__dirname, \"/../etc/config.json\"));\n/* harmony default export */ __webpack_exports__[\"default\"] = (function () {\n  return {\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200,\n                  config: config\n                })));\n\n              case 4:\n                _context.prev = 4;\n                _context.t0 = _context[\"catch\"](0);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t0\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t0.message\n                })));\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 4]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/registry/api/apiLoadConfig.js?");

/***/ }),

/***/ "./modules/registry/api/index.js":
/*!***************************************!*\
  !*** ./modules/registry/api/index.js ***!
  \***************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _apiLoadConfig__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./apiLoadConfig */ \"./modules/registry/api/apiLoadConfig.js\");\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  fastify.post('/api/config/load', Object(_apiLoadConfig__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(fastify));\n});\n\n//# sourceURL=webpack:///./modules/registry/api/index.js?");

/***/ }),

/***/ "./modules/users/api/apiLogin.js":
/*!***************************************!*\
  !*** ./modules/users/api/apiLogin.js ***!
  \***************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var uuid_v1__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! uuid/v1 */ \"uuid/v1\");\n/* harmony import */ var uuid_v1__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(uuid_v1__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _etc_secure_json__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../etc/secure.json */ \"./etc/secure.json\");\nvar _etc_secure_json__WEBPACK_IMPORTED_MODULE_4___namespace = /*#__PURE__*/__webpack_require__.t(/*! ../../../etc/secure.json */ \"./etc/secure.json\", 1);\n\n\n\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  return {\n    schema: {\n      body: {\n        type: 'object',\n        properties: {\n          username: {\n            type: 'string',\n            minLength: 4,\n            maxLength: 32,\n            pattern: '^[a-zA-Z0-9_-]+$'\n          },\n          password: {\n            type: 'string',\n            minLength: 8,\n            maxLength: 64\n          }\n        },\n        required: ['username', 'password']\n      }\n    },\n    attachValidation: true,\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        var passwordHash, user, sessionId, userId, token;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.validationError) {\n                  _context.next = 3;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: req.validationError.message\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify(req.validationError)));\n\n              case 3:\n                _context.prev = 3;\n                passwordHash = crypto__WEBPACK_IMPORTED_MODULE_2___default.a.createHmac('sha512', _etc_secure_json__WEBPACK_IMPORTED_MODULE_4__.secret).update(req.body.password).digest('hex');\n                _context.next = 7;\n                return this.mongo.db.collection('users').findOne({\n                  username: req.body.username\n                });\n\n              case 7:\n                user = _context.sent;\n\n                if (!(!user || user.password !== passwordHash)) {\n                  _context.next = 10;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 403,\n                  message: 'User not found or invalid password',\n                  errors: {\n                    \"default\": {\n                      username: '',\n                      password: ''\n                    }\n                  }\n                })));\n\n              case 10:\n                // Prepare token\n                sessionId = user.sessionId || uuid_v1__WEBPACK_IMPORTED_MODULE_3___default()();\n                userId = String(user._id);\n                token = fastify.jwt.sign({\n                  userId: userId,\n                  sessionId: sessionId\n                }, {\n                  expiresIn: _etc_secure_json__WEBPACK_IMPORTED_MODULE_4__.authTokenExpiresIn\n                }); // Update database and set session ID\n\n                _context.next = 15;\n                return this.mongo.db.collection('users').updateOne({\n                  _id: user._id\n                }, {\n                  $set: {\n                    sessionId: sessionId\n                  }\n                });\n\n              case 15:\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200,\n                  token: token,\n                  user: {\n                    username: user.username,\n                    id: String(user._id)\n                  }\n                })));\n\n              case 18:\n                _context.prev = 18;\n                _context.t0 = _context[\"catch\"](3);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t0\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t0.message\n                })));\n\n              case 22:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[3, 18]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/users/api/apiLogin.js?");

/***/ }),

/***/ "./modules/users/api/apiLogout.js":
/*!****************************************!*\
  !*** ./modules/users/api/apiLogout.js ***!
  \****************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _shared_lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../shared/lib/auth */ \"./shared/lib/auth.js\");\n\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  return {\n    schema: {\n      body: {\n        type: 'object',\n        properties: {\n          token: {\n            type: 'string'\n          }\n        },\n        required: ['token']\n      }\n    },\n    attachValidation: true,\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        var user;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.validationError) {\n                  _context.next = 3;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: req.validationError.message\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify(req.validationError)));\n\n              case 3:\n                _context.next = 5;\n                return _shared_lib_auth__WEBPACK_IMPORTED_MODULE_2__[\"default\"].verifyToken(req.body.token, fastify, this.mongo.db);\n\n              case 5:\n                user = _context.sent;\n\n                if (user) {\n                  _context.next = 9;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: 'Authentication failed'\n                });\n                return _context.abrupt(\"return\", rep.code(403).send(JSON.stringify({\n                  statusCode: 403,\n                  error: 'Authentication failed'\n                })));\n\n              case 9:\n                _context.prev = 9;\n                _context.next = 12;\n                return this.mongo.db.collection('users').updateOne({\n                  _id: user._id\n                }, {\n                  $set: {\n                    sessionId: null\n                  }\n                });\n\n              case 12:\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200\n                })));\n\n              case 15:\n                _context.prev = 15;\n                _context.t0 = _context[\"catch\"](9);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t0\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t0.message\n                })));\n\n              case 19:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[9, 15]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/users/api/apiLogout.js?");

/***/ }),

/***/ "./modules/users/api/apiUserFieldSave.js":
/*!***********************************************!*\
  !*** ./modules/users/api/apiUserFieldSave.js ***!
  \***********************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _shared_lib_auth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../shared/lib/auth */ \"./shared/lib/auth.js\");\n\n\n\n\nvar editableColumns = ['username', 'email', 'active'];\nvar noDupes = ['username', 'email'];\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  return {\n    schema: {\n      body: {\n        type: 'object',\n        properties: {\n          token: {\n            type: 'string'\n          },\n          columnId: {\n            type: 'string',\n            pattern: \"^(\".concat(editableColumns.join('|'), \")$\")\n          },\n          recordId: {\n            type: 'string',\n            minLength: 24,\n            maxLength: 24,\n            pattern: '^[a-f0-9]+$'\n          },\n          value: {\n            type: 'string',\n            minLength: 0,\n            maxLength: 128\n          }\n        },\n        required: ['token', 'columnId', 'recordId']\n      }\n    },\n    attachValidation: true,\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        var value, user, userRecord, formatValidationError, dupeQuery, dupeRecord, update;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.validationError) {\n                  _context.next = 3;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: req.validationError.message\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify(req.validationError)));\n\n              case 3:\n                value = req.body.value || ''; // End of Validation\n                // Check permissions\n\n                _context.next = 6;\n                return _shared_lib_auth__WEBPACK_IMPORTED_MODULE_3__[\"default\"].verifyToken(req.body.token, fastify, this.mongo.db);\n\n              case 6:\n                user = _context.sent;\n\n                if (!(!user || !user.admin)) {\n                  _context.next = 10;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: 'Authentication failed'\n                });\n                return _context.abrupt(\"return\", rep.code(403).send(JSON.stringify({\n                  statusCode: 403,\n                  error: 'Authentication failed'\n                })));\n\n              case 10:\n                _context.prev = 10;\n                _context.next = 13;\n                return this.mongo.db.collection('users').findOne({\n                  _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__[\"ObjectId\"](req.body.recordId)\n                });\n\n              case 13:\n                userRecord = _context.sent;\n\n                if (userRecord) {\n                  _context.next = 16;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify({\n                  statusCode: 400,\n                  error: 'Non-existent record'\n                })));\n\n              case 16:\n                _context.t0 = req.body.columnId;\n                _context.next = _context.t0 === 'username' ? 19 : _context.t0 === 'email' ? 22 : _context.t0 === 'active' ? 25 : 28;\n                break;\n\n              case 19:\n                formatValidationError = !value || !value.match(/^[a-z0-9_-]{4,32}$/i);\n\n                if (!formatValidationError) {\n                  value = value.toLowerCase();\n                }\n\n                return _context.abrupt(\"break\", 30);\n\n              case 22:\n                // eslint-disable-next-line no-control-regex\n                formatValidationError = !value || !value.match(/^(?:[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-])+@(?:[a-zA-Z0-9]|[^\\u0000-\\u007F])(?:(?:[a-zA-Z0-9-]|[^\\u0000-\\u007F]){0,61}(?:[a-zA-Z0-9]|[^\\u0000-\\u007F]))?(?:\\.(?:[a-zA-Z0-9]|[^\\u0000-\\u007F])(?:(?:[a-zA-Z0-9-]|[^\\u0000-\\u007F]){0,61}(?:[a-zA-Z0-9]|[^\\u0000-\\u007F]))?)*$/);\n\n                if (!formatValidationError) {\n                  value = value.toLowerCase();\n                }\n\n                return _context.abrupt(\"break\", 30);\n\n              case 25:\n                // eslint-disable-next-line no-control-regex\n                formatValidationError = !value.match(/^(0|1)$/);\n\n                if (!formatValidationError) {\n                  value = parseInt(value, 10);\n                }\n\n                return _context.abrupt(\"break\", 30);\n\n              case 28:\n                formatValidationError = false;\n                return _context.abrupt(\"break\", 30);\n\n              case 30:\n                if (!formatValidationError) {\n                  _context.next = 32;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 400,\n                  errorCode: 2,\n                  errorField: req.body.columnId,\n                  error: 'Invalid format'\n                })));\n\n              case 32:\n                if (!(noDupes.indexOf(req.body.columnId) !== -1 && userRecord[req.body.columnId] !== value)) {\n                  _context.next = 40;\n                  break;\n                }\n\n                dupeQuery = {};\n                dupeQuery[req.body.columnId] = value;\n                _context.next = 37;\n                return this.mongo.db.collection('users').findOne(dupeQuery);\n\n              case 37:\n                dupeRecord = _context.sent;\n\n                if (!dupeRecord) {\n                  _context.next = 40;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 400,\n                  errorCode: 1,\n                  error: 'Duplicate value'\n                })));\n\n              case 40:\n                // Update if value mismatches\n                if (userRecord[req.body.columnId] !== value) {\n                  update = {};\n                  update[req.body.columnId] = value;\n                  this.mongo.db.collection('users').updateOne({\n                    _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__[\"ObjectId\"](req.body.recordId)\n                  }, {\n                    $set: update\n                  });\n                } // Send response\n\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200,\n                  value: value\n                })));\n\n              case 44:\n                _context.prev = 44;\n                _context.t1 = _context[\"catch\"](10);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t1\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t1.message\n                })));\n\n              case 48:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[10, 44]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/users/api/apiUserFieldSave.js?");

/***/ }),

/***/ "./modules/users/api/apiUserLoad.js":
/*!******************************************!*\
  !*** ./modules/users/api/apiUserLoad.js ***!
  \******************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _shared_lib_auth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../shared/lib/auth */ \"./shared/lib/auth.js\");\n\n\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  return {\n    schema: {\n      body: {\n        type: 'object',\n        properties: {\n          token: {\n            type: 'string'\n          },\n          id: {\n            type: 'string',\n            minLength: 24,\n            maxLength: 24,\n            pattern: '^[a-f0-9]+$'\n          }\n        },\n        required: ['token', 'id']\n      }\n    },\n    attachValidation: true,\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        var user, userRecord;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.validationError) {\n                  _context.next = 3;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: req.validationError.message\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify(req.validationError)));\n\n              case 3:\n                _context.next = 5;\n                return _shared_lib_auth__WEBPACK_IMPORTED_MODULE_3__[\"default\"].verifyToken(req.body.token, fastify, this.mongo.db);\n\n              case 5:\n                user = _context.sent;\n\n                if (!(!user || !user.admin)) {\n                  _context.next = 9;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: 'Authentication failed'\n                });\n                return _context.abrupt(\"return\", rep.code(403).send(JSON.stringify({\n                  statusCode: 403,\n                  error: 'Authentication failed'\n                })));\n\n              case 9:\n                _context.prev = 9;\n                _context.next = 12;\n                return this.mongo.db.collection('users').findOne({\n                  _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__[\"ObjectId\"](req.body.id)\n                });\n\n              case 12:\n                userRecord = _context.sent;\n\n                if (userRecord) {\n                  _context.next = 15;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify({\n                  statusCode: 400,\n                  error: 'Non-existent record'\n                })));\n\n              case 15:\n                delete userRecord.password; // Send response\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200,\n                  data: {\n                    \"default\": {\n                      username: userRecord.username,\n                      email: userRecord.email,\n                      active: userRecord.active ? '1' : '0',\n                      admin: userRecord.admin ? '1' : '0'\n                    }\n                  }\n                })));\n\n              case 19:\n                _context.prev = 19;\n                _context.t0 = _context[\"catch\"](9);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t0\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t0.message\n                })));\n\n              case 23:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[9, 19]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/users/api/apiUserLoad.js?");

/***/ }),

/***/ "./modules/users/api/apiUserSave.js":
/*!******************************************!*\
  !*** ./modules/users/api/apiUserSave.js ***!
  \******************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/defineProperty */ \"@babel/runtime/helpers/defineProperty\");\n/* harmony import */ var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var ajv__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ajv */ \"ajv\");\n/* harmony import */ var ajv__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(ajv__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _etc_secure_json__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../etc/secure.json */ \"./etc/secure.json\");\nvar _etc_secure_json__WEBPACK_IMPORTED_MODULE_6___namespace = /*#__PURE__*/__webpack_require__.t(/*! ../../../etc/secure.json */ \"./etc/secure.json\", 1);\n/* harmony import */ var _shared_lib_auth__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../shared/lib/auth */ \"./shared/lib/auth.js\");\n\n\n\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_1___default()(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n\n\n\n\n\nvar ajv = new ajv__WEBPACK_IMPORTED_MODULE_3___default.a();\nvar baseValidate = ajv.compile({\n  type: 'object',\n  properties: {\n    token: {\n      type: 'string'\n    },\n    id: {\n      type: 'string'\n    }\n  },\n  required: ['token']\n});\nvar formValidate = ajv.compile({\n  type: 'object',\n  properties: {\n    username: {\n      type: 'string',\n      minLength: 4,\n      maxLength: 32,\n      pattern: '^[a-zA-Z0-9_-]+$'\n    },\n    password: {\n      type: 'string'\n    },\n    email: {\n      type: 'string',\n      minLength: 6,\n      maxLength: 129,\n      pattern: \"^(?:[a-zA-Z0-9.!#$%&'*+\\\\/=?^_`{|}~-])+@(?:[a-zA-Z0-9]|[^\\\\u0000-\\\\u007F])(?:(?:[a-zA-Z0-9-]|[^\\\\u0000-\\\\u007F]){0,61}(?:[a-zA-Z0-9]|[^\\\\u0000-\\\\u007F]))?(?:\\\\.(?:[a-zA-Z0-9]|[^\\\\u0000-\\\\u007F])(?:(?:[a-zA-Z0-9-]|[^\\\\u0000-\\\\u007F]){0,61}(?:[a-zA-Z0-9]|[^\\\\u0000-\\\\u007F]))?)*$\"\n    },\n    active: {\n      type: 'string',\n      pattern: '^(0|1)$'\n    },\n    admin: {\n      type: 'string',\n      pattern: '^(0|1)$'\n    }\n  },\n  required: ['username', 'email', 'active', 'admin']\n});\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  return {\n    schema: {\n      body: {\n        type: 'object',\n        properties: {\n          __form_data: {\n            type: 'string'\n          }\n        },\n        required: ['__form_data']\n      }\n    },\n    attachValidation: true,\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        var formData, baseDataValidation, formDataValidation, errorData, user, passwordUpdate, username, dupeUsernameQuery, dupeUsername, dupeEmailQuery, dupeEmail, update;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.validationError) {\n                  _context.next = 3;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: req.validationError.message\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify(req.validationError)));\n\n              case 3:\n                _context.prev = 3;\n                formData = JSON.parse(req.body.__form_data); // Start of Form Validation\n\n                baseDataValidation = baseValidate(formData);\n                formDataValidation = formValidate(formData[\"default\"]);\n\n                if (!(!baseDataValidation || !formDataValidation || formData.id && (formData.id.length !== 24 || !formData.id.match(/^[a-f0-9]+$/)))) {\n                  _context.next = 11;\n                  break;\n                }\n\n                errorData = {\n                  base: baseDataValidation ? undefined : baseValidate.errors || {\n                    error: 'General validation error'\n                  },\n                  form: formDataValidation ? null : formValidate.errors || {\n                    error: 'General validation error'\n                  }\n                };\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: errorData\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify({\n                  statusCode: 400,\n                  error: errorData\n                })));\n\n              case 11:\n                formData[\"default\"].active = parseInt(formData[\"default\"].active, 10);\n                formData[\"default\"].admin = parseInt(formData[\"default\"].admin, 10); // End of Form Validation\n                // Check permissions\n\n                _context.next = 15;\n                return _shared_lib_auth__WEBPACK_IMPORTED_MODULE_7__[\"default\"].verifyToken(formData.token, fastify, this.mongo.db);\n\n              case 15:\n                user = _context.sent;\n\n                if (!(!user || !user.admin)) {\n                  _context.next = 19;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: 'Authentication failed'\n                });\n                return _context.abrupt(\"return\", rep.code(403).send(JSON.stringify({\n                  statusCode: 403,\n                  error: 'Authentication failed'\n                })));\n\n              case 19:\n                // End of check permissions\n                // Password-related checks\n                passwordUpdate = {};\n\n                if (!(!formData.id && !formData[\"default\"].password)) {\n                  _context.next = 22;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 400,\n                  errors: {\n                    \"default\": {\n                      password: 'Required'\n                    }\n                  }\n                })));\n\n              case 22:\n                if (!formData[\"default\"].password) {\n                  _context.next = 26;\n                  break;\n                }\n\n                if (!(formData[\"default\"].password.length < 8)) {\n                  _context.next = 25;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 400,\n                  errors: {\n                    \"default\": {\n                      password: 'Too short'\n                    }\n                  }\n                })));\n\n              case 25:\n                passwordUpdate.password = crypto__WEBPACK_IMPORTED_MODULE_5___default.a.createHmac('sha512', _etc_secure_json__WEBPACK_IMPORTED_MODULE_6__.secret).update(formData[\"default\"].password).digest('hex');\n\n              case 26:\n                if (!formData.id) {\n                  _context.next = 32;\n                  break;\n                }\n\n                _context.next = 29;\n                return this.mongo.db.collection('users').findOne({\n                  _id: new mongodb__WEBPACK_IMPORTED_MODULE_4__[\"ObjectId\"](formData.id)\n                });\n\n              case 29:\n                username = _context.sent;\n\n                if (username) {\n                  _context.next = 32;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 400,\n                  errors: {\n                    \"default\": {\n                      username: 'User not found'\n                    }\n                  }\n                })));\n\n              case 32:\n                // Check if user with such username already exists\n                dupeUsernameQuery = {\n                  username: formData[\"default\"].username\n                };\n\n                if (formData.id) {\n                  dupeUsernameQuery._id = {\n                    $ne: new mongodb__WEBPACK_IMPORTED_MODULE_4__[\"ObjectId\"](formData.id)\n                  };\n                }\n\n                _context.next = 36;\n                return this.mongo.db.collection('users').findOne(dupeUsernameQuery);\n\n              case 36:\n                dupeUsername = _context.sent;\n\n                if (!dupeUsername) {\n                  _context.next = 39;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 400,\n                  errors: {\n                    \"default\": {\n                      username: 'Duplicate username'\n                    }\n                  }\n                })));\n\n              case 39:\n                // Check if user with such e-mail address already exists\n                dupeEmailQuery = {\n                  email: formData[\"default\"].email\n                };\n\n                if (formData.id) {\n                  dupeEmailQuery._id = {\n                    $ne: new mongodb__WEBPACK_IMPORTED_MODULE_4__[\"ObjectId\"](formData.id)\n                  };\n                }\n\n                _context.next = 43;\n                return this.mongo.db.collection('users').findOne(dupeEmailQuery);\n\n              case 43:\n                dupeEmail = _context.sent;\n\n                if (!dupeEmail) {\n                  _context.next = 46;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 400,\n                  errors: {\n                    \"default\": {\n                      email: 'Duplicate e-mail'\n                    }\n                  }\n                })));\n\n              case 46:\n                _context.next = 48;\n                return this.mongo.db.collection('users').updateOne(formData.id ? {\n                  _id: new mongodb__WEBPACK_IMPORTED_MODULE_4__[\"ObjectId\"](formData.id)\n                } : {\n                  username: formData[\"default\"].username\n                }, {\n                  $set: _objectSpread({\n                    username: formData[\"default\"].username,\n                    email: formData[\"default\"].email,\n                    active: formData[\"default\"].active,\n                    admin: formData[\"default\"].admin\n                  }, passwordUpdate)\n                }, {\n                  upsert: true\n                });\n\n              case 48:\n                update = _context.sent;\n\n                if (!(!update || !update.result || !update.result.ok)) {\n                  _context.next = 51;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 400,\n                  error: 'Cannot update database record'\n                })));\n\n              case 51:\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200\n                })));\n\n              case 54:\n                _context.prev = 54;\n                _context.t0 = _context[\"catch\"](3);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t0\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t0.message\n                })));\n\n              case 58:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[3, 54]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/users/api/apiUserSave.js?");

/***/ }),

/***/ "./modules/users/api/apiUsersDelete.js":
/*!*********************************************!*\
  !*** ./modules/users/api/apiUsersDelete.js ***!
  \*********************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _shared_lib_auth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../shared/lib/auth */ \"./shared/lib/auth.js\");\n\n\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  return {\n    schema: {\n      body: {\n        type: 'object',\n        properties: {\n          token: {\n            type: 'string'\n          },\n          ids: {\n            type: 'array',\n            minItems: 1,\n            contains: {\n              type: 'string',\n              minLength: 24,\n              maxLength: 24,\n              pattern: '^[a-f0-9]+$'\n            }\n          }\n        },\n        required: ['token', 'ids']\n      }\n    },\n    attachValidation: true,\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        var user, query, result;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.validationError) {\n                  _context.next = 3;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: req.validationError.message\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify(req.validationError)));\n\n              case 3:\n                _context.next = 5;\n                return _shared_lib_auth__WEBPACK_IMPORTED_MODULE_3__[\"default\"].verifyToken(req.body.token, fastify, this.mongo.db);\n\n              case 5:\n                user = _context.sent;\n\n                if (!(!user || !user.admin)) {\n                  _context.next = 9;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: 'Authentication failed'\n                });\n                return _context.abrupt(\"return\", rep.code(403).send(JSON.stringify({\n                  statusCode: 403,\n                  error: 'Authentication failed'\n                })));\n\n              case 9:\n                _context.prev = 9;\n                query = req.body.ids.map(function (id) {\n                  return {\n                    _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__[\"ObjectId\"](id)\n                  };\n                });\n                _context.next = 13;\n                return this.mongo.db.collection('users').deleteMany({\n                  $or: query\n                });\n\n              case 13:\n                result = _context.sent;\n\n                if (!(!result || !result.result || !result.result.ok)) {\n                  _context.next = 16;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 400,\n                  error: 'Cannot delete database record(s)'\n                })));\n\n              case 16:\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200\n                })));\n\n              case 19:\n                _context.prev = 19;\n                _context.t0 = _context[\"catch\"](9);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t0\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t0.message\n                })));\n\n              case 23:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[9, 19]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/users/api/apiUsersDelete.js?");

/***/ }),

/***/ "./modules/users/api/apiUsersList.js":
/*!*******************************************!*\
  !*** ./modules/users/api/apiUsersList.js ***!
  \*******************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var fs_extra__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs-extra */ \"fs-extra\");\n/* harmony import */ var fs_extra__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs_extra__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _shared_lib_auth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../shared/lib/auth */ \"./shared/lib/auth.js\");\n\n\n\n\nvar config = fs_extra__WEBPACK_IMPORTED_MODULE_2___default.a.readJSONSync(\"\".concat(__dirname, \"/../etc/config.json\"));\nvar sortColumns = ['username', 'email', 'active'];\nvar searchColumns = ['username', 'email'];\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  return {\n    schema: {\n      body: {\n        type: 'object',\n        properties: {\n          token: {\n            type: 'string'\n          },\n          page: {\n            type: 'integer',\n            minimum: 1,\n            maximum: 999999999\n          },\n          search: {\n            type: 'string',\n            maxLength: 64\n          },\n          sortColumn: {\n            type: 'string',\n            pattern: \"^(\".concat(sortColumns.join('|'), \")$\")\n          },\n          sortDirection: {\n            type: 'string',\n            pattern: '^(asc|desc)$'\n          }\n        },\n        required: ['token', 'page', 'sortColumn', 'sortDirection']\n      }\n    },\n    attachValidation: true,\n    handler: function () {\n      var _handler = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n      /*#__PURE__*/\n      _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(req, rep) {\n        var user, options, query, count, users;\n        return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!req.validationError) {\n                  _context.next = 3;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: req.validationError.message\n                });\n                return _context.abrupt(\"return\", rep.code(400).send(JSON.stringify(req.validationError)));\n\n              case 3:\n                _context.next = 5;\n                return _shared_lib_auth__WEBPACK_IMPORTED_MODULE_3__[\"default\"].verifyToken(req.body.token, fastify, this.mongo.db);\n\n              case 5:\n                user = _context.sent;\n\n                if (!(!user || !user.admin)) {\n                  _context.next = 9;\n                  break;\n                }\n\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: 'Authentication failed'\n                });\n                return _context.abrupt(\"return\", rep.code(403).send(JSON.stringify({\n                  statusCode: 403,\n                  error: 'Authentication failed'\n                })));\n\n              case 9:\n                _context.prev = 9;\n                // Get users\n                options = {\n                  sort: {}\n                };\n                query = {};\n\n                if (req.body.search) {\n                  query.$or = searchColumns.map(function (c) {\n                    var sr = {};\n                    sr[c] = {\n                      $regex: req.body.search,\n                      $options: 'i'\n                    };\n                    return sr;\n                  });\n                }\n\n                _context.next = 15;\n                return this.mongo.db.collection('users').find(query, options).count();\n\n              case 15:\n                count = _context.sent;\n                options.limit = config.commonItemsLimit;\n                options.skip = (req.body.page - 1) * config.commonItemsLimit;\n                options.projection = {\n                  _id: 1,\n                  username: 1,\n                  email: 1,\n                  active: 1\n                };\n                options.sort[req.body.sortColumn] = req.body.sortDirection === 'asc' ? 1 : -1;\n                _context.next = 22;\n                return this.mongo.db.collection('users').find(query, options).toArray();\n\n              case 22:\n                users = _context.sent;\n                return _context.abrupt(\"return\", rep.code(200).send(JSON.stringify({\n                  statusCode: 200,\n                  items: users,\n                  total: count\n                })));\n\n              case 26:\n                _context.prev = 26;\n                _context.t0 = _context[\"catch\"](9);\n                req.log.error({\n                  ip: req.ip,\n                  path: req.urlData().path,\n                  query: req.urlData().query,\n                  error: _context.t0\n                });\n                return _context.abrupt(\"return\", rep.code(500).send(JSON.stringify({\n                  statusCode: 500,\n                  error: 'Internal server error',\n                  message: _context.t0.message\n                })));\n\n              case 30:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[9, 26]]);\n      }));\n\n      function handler(_x, _x2) {\n        return _handler.apply(this, arguments);\n      }\n\n      return handler;\n    }()\n  };\n});\n\n//# sourceURL=webpack:///./modules/users/api/apiUsersList.js?");

/***/ }),

/***/ "./modules/users/api/index.js":
/*!************************************!*\
  !*** ./modules/users/api/index.js ***!
  \************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _apiLogin__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./apiLogin */ \"./modules/users/api/apiLogin.js\");\n/* harmony import */ var _apiLogout__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./apiLogout */ \"./modules/users/api/apiLogout.js\");\n/* harmony import */ var _apiUsersList__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./apiUsersList */ \"./modules/users/api/apiUsersList.js\");\n/* harmony import */ var _apiUserFieldSave__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./apiUserFieldSave */ \"./modules/users/api/apiUserFieldSave.js\");\n/* harmony import */ var _apiUserLoad__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./apiUserLoad */ \"./modules/users/api/apiUserLoad.js\");\n/* harmony import */ var _apiUserSave__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./apiUserSave */ \"./modules/users/api/apiUserSave.js\");\n/* harmony import */ var _apiUsersDelete__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./apiUsersDelete */ \"./modules/users/api/apiUsersDelete.js\");\n\n\n\n\n\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (fastify) {\n  fastify.post('/api/users/login', Object(_apiLogin__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(fastify));\n  fastify.post('/api/users/logout', Object(_apiLogout__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(fastify));\n  fastify.post('/api/users/list', Object(_apiUsersList__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(fastify));\n  fastify.post('/api/users/save/field', Object(_apiUserFieldSave__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(fastify));\n  fastify.post('/api/users/load', Object(_apiUserLoad__WEBPACK_IMPORTED_MODULE_4__[\"default\"])(fastify));\n  fastify.post('/api/users/save', Object(_apiUserSave__WEBPACK_IMPORTED_MODULE_5__[\"default\"])(fastify));\n  fastify.post('/api/users/delete', Object(_apiUsersDelete__WEBPACK_IMPORTED_MODULE_6__[\"default\"])(fastify));\n});\n\n//# sourceURL=webpack:///./modules/users/api/index.js?");

/***/ }),

/***/ "./shared/api/api.js":
/*!***************************!*\
  !*** ./shared/api/api.js ***!
  \***************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _etc_secure_json__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../etc/secure.json */ \"./etc/secure.json\");\nvar _etc_secure_json__WEBPACK_IMPORTED_MODULE_2___namespace = /*#__PURE__*/__webpack_require__.t(/*! ../../etc/secure.json */ \"./etc/secure.json\", 1);\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/logger */ \"./shared/lib/logger.js\");\n/* harmony import */ var fastify_mongodb__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! fastify-mongodb */ \"fastify-mongodb\");\n/* harmony import */ var fastify_mongodb__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(fastify_mongodb__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var fastify_url_data__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! fastify-url-data */ \"fastify-url-data\");\n/* harmony import */ var fastify_url_data__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(fastify_url_data__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var fastify_cors__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! fastify-cors */ \"fastify-cors\");\n/* harmony import */ var fastify_cors__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(fastify_cors__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var fastify_jwt__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! fastify-jwt */ \"fastify-jwt\");\n/* harmony import */ var fastify_jwt__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(fastify_jwt__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var fastify_formbody__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! fastify-formbody */ \"fastify-formbody\");\n/* harmony import */ var fastify_formbody__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(fastify_formbody__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var fastify_multipart__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! fastify-multipart */ \"fastify-multipart\");\n/* harmony import */ var fastify_multipart__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(fastify_multipart__WEBPACK_IMPORTED_MODULE_9__);\n/* harmony import */ var _build_modules_json__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../build/modules.json */ \"./shared/build/modules.json\");\nvar _build_modules_json__WEBPACK_IMPORTED_MODULE_10___namespace = /*#__PURE__*/__webpack_require__.t(/*! ../build/modules.json */ \"./shared/build/modules.json\", 1);\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_11__);\n/* harmony import */ var pino__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! pino */ \"pino\");\n/* harmony import */ var pino__WEBPACK_IMPORTED_MODULE_12___default = /*#__PURE__*/__webpack_require__.n(pino__WEBPACK_IMPORTED_MODULE_12__);\n/* harmony import */ var fastify__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! fastify */ \"fastify\");\n/* harmony import */ var fastify__WEBPACK_IMPORTED_MODULE_13___default = /*#__PURE__*/__webpack_require__.n(fastify__WEBPACK_IMPORTED_MODULE_13__);\n\n\n\n/* eslint-disable import/order */\n\n\n\n\n\n\n\n\n\n\n\n\nvar log = pino__WEBPACK_IMPORTED_MODULE_12___default()({\n  level: _etc_secure_json__WEBPACK_IMPORTED_MODULE_2__.loglevel\n});\nvar fastify = fastify__WEBPACK_IMPORTED_MODULE_13___default()({\n  logger: _lib_logger__WEBPACK_IMPORTED_MODULE_3__[\"default\"],\n  trustProxy: _etc_secure_json__WEBPACK_IMPORTED_MODULE_2__.trustProxy\n});\n\n_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n/*#__PURE__*/\n_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee2() {\n  var mongoClient;\n  return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee2$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          mongoClient = new mongodb__WEBPACK_IMPORTED_MODULE_11__[\"MongoClient\"](_etc_secure_json__WEBPACK_IMPORTED_MODULE_2__.mongo.url, {\n            useNewUrlParser: true,\n            useUnifiedTopology: true\n          });\n          _context2.next = 3;\n          return mongoClient.connect();\n\n        case 3:\n          fastify.register(fastify_formbody__WEBPACK_IMPORTED_MODULE_8___default.a);\n          fastify.register(fastify_multipart__WEBPACK_IMPORTED_MODULE_9___default.a, {\n            addToBody: true\n          });\n          fastify.register(fastify_url_data__WEBPACK_IMPORTED_MODULE_5___default.a);\n          fastify.register(fastify_mongodb__WEBPACK_IMPORTED_MODULE_4___default.a, {\n            client: mongoClient,\n            database: _etc_secure_json__WEBPACK_IMPORTED_MODULE_2__.mongo.dbName\n          }).register(function (ff, opts, next) {\n            ff.mongo.client.db(_etc_secure_json__WEBPACK_IMPORTED_MODULE_2__.mongo.dbName).on('close', function () {\n              log.error('Connection to MongoDB is broken');\n              process.exit(1);\n            });\n            next();\n          });\n          fastify.register(fastify_cors__WEBPACK_IMPORTED_MODULE_6___default.a, {\n            origin: _etc_secure_json__WEBPACK_IMPORTED_MODULE_2__.originCORS\n          });\n          fastify.register(fastify_jwt__WEBPACK_IMPORTED_MODULE_7___default.a, {\n            secret: _etc_secure_json__WEBPACK_IMPORTED_MODULE_2__.secret\n          });\n          _context2.next = 11;\n          return Promise.all(Object.keys(_build_modules_json__WEBPACK_IMPORTED_MODULE_10__).map(\n          /*#__PURE__*/\n          function () {\n            var _ref2 = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n            /*#__PURE__*/\n            _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(m) {\n              var module;\n              return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      _context.next = 2;\n                      return __webpack_require__(\"./modules lazy recursive ^\\\\.\\\\/.*\\\\/api\\\\/index\\\\.js$\")(\"./\".concat(m, \"/api/index.js\"));\n\n                    case 2:\n                      module = _context.sent;\n                      module[\"default\"](fastify);\n\n                    case 4:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, _callee);\n            }));\n\n            return function (_x) {\n              return _ref2.apply(this, arguments);\n            };\n          }()));\n\n        case 11:\n          log.info('Starting API server...');\n          fastify.listen(_etc_secure_json__WEBPACK_IMPORTED_MODULE_2__.apiServer.port, _etc_secure_json__WEBPACK_IMPORTED_MODULE_2__.apiServer.ip);\n\n        case 13:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _callee2);\n}))()[\"catch\"](function (err) {\n  log.error(err);\n  process.exit(1);\n});\n\n//# sourceURL=webpack:///./shared/api/api.js?");

/***/ }),

/***/ "./shared/build/modules.json":
/*!***********************************!*\
  !*** ./shared/build/modules.json ***!
  \***********************************/
/*! exports provided: admin, pages, registry, users, default */
/***/ (function(module) {

eval("module.exports = JSON.parse(\"{\\\"admin\\\":{\\\"id\\\":\\\"admin\\\",\\\"icon\\\":\\\"\\\",\\\"admin\\\":false,\\\"adminRoute\\\":\\\"/admin/users\\\"},\\\"pages\\\":{\\\"id\\\":\\\"pages\\\",\\\"icon\\\":\\\"file-text\\\",\\\"admin\\\":true,\\\"adminRoute\\\":\\\"/admin/pages\\\"},\\\"registry\\\":{\\\"id\\\":\\\"registry\\\",\\\"icon\\\":\\\"\\\",\\\"admin\\\":false,\\\"adminRoute\\\":\\\"\\\"},\\\"users\\\":{\\\"id\\\":\\\"users\\\",\\\"icon\\\":\\\"users\\\",\\\"admin\\\":true,\\\"adminRoute\\\":\\\"/admin/users\\\"}}\");\n\n//# sourceURL=webpack:///./shared/build/modules.json?");

/***/ }),

/***/ "./shared/lib/auth.js":
/*!****************************!*\
  !*** ./shared/lib/auth.js ***!
  \****************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/regenerator */ \"@babel/runtime/regenerator\");\n/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ \"@babel/runtime/helpers/asyncToGenerator\");\n/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = ({\n  verifyToken: function () {\n    var _verifyToken = _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(\n    /*#__PURE__*/\n    _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee(token, fastify, db) {\n      var decodedToken, user;\n      return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              decodedToken = fastify.jwt.decode(token);\n\n              if (!(!decodedToken || !decodedToken.userId || !decodedToken.sessionId || Math.floor(Date.now() / 1000) > decodedToken.exp)) {\n                _context.next = 4;\n                break;\n              }\n\n              return _context.abrupt(\"return\", null);\n\n            case 4:\n              _context.next = 6;\n              return db.collection('users').findOne({\n                _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__[\"ObjectId\"](decodedToken.userId)\n              });\n\n            case 6:\n              user = _context.sent;\n\n              if (!(!user || !user.active || user.sessionId !== decodedToken.sessionId)) {\n                _context.next = 9;\n                break;\n              }\n\n              return _context.abrupt(\"return\", null);\n\n            case 9:\n              return _context.abrupt(\"return\", user);\n\n            case 12:\n              _context.prev = 12;\n              _context.t0 = _context[\"catch\"](0);\n              return _context.abrupt(\"return\", null);\n\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 12]]);\n    }));\n\n    function verifyToken(_x, _x2, _x3) {\n      return _verifyToken.apply(this, arguments);\n    }\n\n    return verifyToken;\n  }()\n});\n\n//# sourceURL=webpack:///./shared/lib/auth.js?");

/***/ }),

/***/ "./shared/lib/logger.js":
/*!******************************!*\
  !*** ./shared/lib/logger.js ***!
  \******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _etc_secure_json__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../etc/secure.json */ \"./etc/secure.json\");\nvar _etc_secure_json__WEBPACK_IMPORTED_MODULE_0___namespace = /*#__PURE__*/__webpack_require__.t(/*! ../../etc/secure.json */ \"./etc/secure.json\", 1);\n/* harmony import */ var pino__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! pino */ \"pino\");\n/* harmony import */ var pino__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(pino__WEBPACK_IMPORTED_MODULE_1__);\n // eslint-disable-next-line import/order\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (pino__WEBPACK_IMPORTED_MODULE_1___default()({\n  level: _etc_secure_json__WEBPACK_IMPORTED_MODULE_0__.loglevel\n}));\n\n//# sourceURL=webpack:///./shared/lib/logger.js?");

/***/ }),

/***/ "@babel/runtime/helpers/asyncToGenerator":
/*!**********************************************************!*\
  !*** external "@babel/runtime/helpers/asyncToGenerator" ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"@babel/runtime/helpers/asyncToGenerator\");\n\n//# sourceURL=webpack:///external_%22@babel/runtime/helpers/asyncToGenerator%22?");

/***/ }),

/***/ "@babel/runtime/helpers/defineProperty":
/*!********************************************************!*\
  !*** external "@babel/runtime/helpers/defineProperty" ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"@babel/runtime/helpers/defineProperty\");\n\n//# sourceURL=webpack:///external_%22@babel/runtime/helpers/defineProperty%22?");

/***/ }),

/***/ "@babel/runtime/helpers/toConsumableArray":
/*!***********************************************************!*\
  !*** external "@babel/runtime/helpers/toConsumableArray" ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"@babel/runtime/helpers/toConsumableArray\");\n\n//# sourceURL=webpack:///external_%22@babel/runtime/helpers/toConsumableArray%22?");

/***/ }),

/***/ "@babel/runtime/regenerator":
/*!*********************************************!*\
  !*** external "@babel/runtime/regenerator" ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"@babel/runtime/regenerator\");\n\n//# sourceURL=webpack:///external_%22@babel/runtime/regenerator%22?");

/***/ }),

/***/ "ajv":
/*!**********************!*\
  !*** external "ajv" ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"ajv\");\n\n//# sourceURL=webpack:///external_%22ajv%22?");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"crypto\");\n\n//# sourceURL=webpack:///external_%22crypto%22?");

/***/ }),

/***/ "fastify":
/*!**************************!*\
  !*** external "fastify" ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"fastify\");\n\n//# sourceURL=webpack:///external_%22fastify%22?");

/***/ }),

/***/ "fastify-cors":
/*!*******************************!*\
  !*** external "fastify-cors" ***!
  \*******************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"fastify-cors\");\n\n//# sourceURL=webpack:///external_%22fastify-cors%22?");

/***/ }),

/***/ "fastify-formbody":
/*!***********************************!*\
  !*** external "fastify-formbody" ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"fastify-formbody\");\n\n//# sourceURL=webpack:///external_%22fastify-formbody%22?");

/***/ }),

/***/ "fastify-jwt":
/*!******************************!*\
  !*** external "fastify-jwt" ***!
  \******************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"fastify-jwt\");\n\n//# sourceURL=webpack:///external_%22fastify-jwt%22?");

/***/ }),

/***/ "fastify-mongodb":
/*!**********************************!*\
  !*** external "fastify-mongodb" ***!
  \**********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"fastify-mongodb\");\n\n//# sourceURL=webpack:///external_%22fastify-mongodb%22?");

/***/ }),

/***/ "fastify-multipart":
/*!************************************!*\
  !*** external "fastify-multipart" ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"fastify-multipart\");\n\n//# sourceURL=webpack:///external_%22fastify-multipart%22?");

/***/ }),

/***/ "fastify-url-data":
/*!***********************************!*\
  !*** external "fastify-url-data" ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"fastify-url-data\");\n\n//# sourceURL=webpack:///external_%22fastify-url-data%22?");

/***/ }),

/***/ "fs-extra":
/*!***************************!*\
  !*** external "fs-extra" ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"fs-extra\");\n\n//# sourceURL=webpack:///external_%22fs-extra%22?");

/***/ }),

/***/ "jimp":
/*!***********************!*\
  !*** external "jimp" ***!
  \***********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"jimp\");\n\n//# sourceURL=webpack:///external_%22jimp%22?");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"mongodb\");\n\n//# sourceURL=webpack:///external_%22mongodb%22?");

/***/ }),

/***/ "pino":
/*!***********************!*\
  !*** external "pino" ***!
  \***********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"pino\");\n\n//# sourceURL=webpack:///external_%22pino%22?");

/***/ }),

/***/ "uuid/v1":
/*!**************************!*\
  !*** external "uuid/v1" ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = require(\"uuid/v1\");\n\n//# sourceURL=webpack:///external_%22uuid/v1%22?");

/***/ })

/******/ });