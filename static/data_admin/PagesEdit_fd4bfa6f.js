(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{595:function(e,t,a){"use strict";a.r(t);var n=a(21),r=a.n(n),o=a(36),i=a.n(o),d=a(50),l=a.n(d),u=a(51),c=a.n(u),s=a(52),p=a.n(s),m=a(20),f=a.n(m),h=a(53),g=a.n(h),k=a(5),v=a.n(k),E=a(0),F=a.n(E),b=a(74),y=a(15),C=a(114),D=a(73),R=a.n(D),_=a(584),w=a.n(_),S=a(585),x=a.n(S),T=a(75),B=a(599),A=a(600),L=a(115),P=a(27),O=a(116),V=a(72),I=a.n(V),N=a(390),H=a.n(N),j=a(185),z=a.n(j),M=Object(E.lazy)((function(){return Promise.all([a.e(0),a.e(3)]).then(a.bind(null,601))})),U=function(e){function t(e){var a;return l()(this,t),a=c()(this,p()(t).call(this,e)),v()(f()(a),"componentDidMount",(function(){a.dialogFolderEdit=I.a.modal("#dialogFolderEdit_".concat(a.props.id),{bgClose:!1,escClose:!0,stack:!0})})),v()(f()(a),"componentWillUnmount",(function(){a.dialogFolderEdit.$destroy(!0)})),v()(f()(a),"show",function(){var e=i()(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.resetEditForm(),e.next=3,a.editFoldersForm.current.hideErrors();case 3:return t&&(delete(n=H()(t)).key,delete n.title,delete n.children,Object.keys(n.data).map((function(e){return n[e]=n.data[e]})),delete n.data,a.editKey=t.key,a.editChildren=t.children,a.editFoldersForm.current.deserializeData(n)),e.next=6,a.dialogFolderEdit.show();case 6:a.editFoldersForm.current.setFocusOnFields();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),v()(f()(a),"hide",(function(){a.dialogFolderEdit.hide()})),v()(f()(a),"resetEditForm",(function(){return a.editFoldersForm.current.resetValuesToDefault()})),v()(f()(a),"onSaveButtonClick",function(){var e=i()(r.a.mark((function e(t){var n,o,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=a.editFoldersForm.current.serializeData(),o=n.data,i=a.editFoldersForm.current.validateData(o),e.next=5,a.editFoldersForm.current.hideErrors();case 5:if(!i||!i.length){e.next=8;break}return a.editFoldersForm.current.showErrors(i),e.abrupt("return");case 8:o.key=o.key||a.editKey||z()().replace(/-/gm,""),o.children=o.children||a.editChildren,a.props.onSaveButtonClickHandler&&"function"==typeof a.props.onSaveButtonClickHandler&&a.props.onSaveButtonClickHandler(o),a.hide();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),v()(f()(a),"getEditForm",(function(e){return F.a.createElement(M,{ref:a.editFoldersForm,prefix:"editFoldersForm",UIkit:I.a,axios:R.a,i18n:e,tabs:P.languages,commonFields:["id"],data:[[{id:"id",type:"text",css:"uk-form-width-small",label:"".concat(e._({id:"ID"}),":"),autofocus:!0},{id:"title",type:"text",css:"uk-form-width-medium",label:"".concat(e._({id:"Title"}),":")}]],lang:{ERR_VMANDATORY:{id:"Field is required"},ERR_VFORMAT:{id:"Invalid format"},ERR_VNOMATCH:{id:"Passwords do not match"},ERR_LOAD:{id:"Could not load data from server"},ERR_SAVE:{id:"Could not save data"},WILL_BE_DELETED:{id:"will be deleted. Are you sure?"},YES:{id:"Yes"},CANCEL:{id:"Cancel"}},validation:{id:{mandatory:!0,regexp:/^[a-zA-Z0-9_-]{1,32}$/},title:{mandatory:!0,maxLength:64}},onFormPreSubmit:a.onSaveButtonClick})})),v()(f()(a),"render",(function(){return F.a.createElement("div",null,F.a.createElement("div",{id:"dialogFolderEdit_".concat(a.props.id),style:{display:"none"}},F.a.createElement("div",{className:"uk-modal-dialog"},F.a.createElement("div",{className:"uk-modal-body"},a.getEditForm(a.props.i18n)),F.a.createElement("div",{className:"uk-modal-footer uk-text-right"},F.a.createElement("button",{className:"uk-button uk-button-default uk-modal-close uk-margin-small-right",type:"button"},a.props.i18n._({id:"Cancel"})),F.a.createElement("button",{className:"uk-button uk-button-primary",type:"button",onClick:a.onSaveButtonClick},a.props.i18n._({id:"Save"}))))))})),a.editFoldersForm=F.a.createRef(),a}return g()(t,e),t}(E.Component),Y=Object(y.c)((function(e){return{appData:e.appData,appDataRuntime:e.appDataRuntime}}),(function(){return{}}),null,{forwardRef:!0})(U),W=Object(E.lazy)((function(){return Promise.all([a.e(0),a.e(3)]).then(a.bind(null,601))})),$=function(e){function t(e){var a;return l()(this,t),a=c()(this,p()(t).call(this,e)),v()(f()(a),"componentDidMount",(function(){a.dialogFolder=I.a.modal("#dialogFolder_".concat(a.props.id),{bgClose:!1,escClose:!0,stack:!0})})),v()(f()(a),"componentWillUnmount",(function(){a.dialogFolder.$destroy(!0)})),v()(f()(a),"show",(function(){a.dialogFolder.show()})),v()(f()(a),"hide",(function(){a.dialogFolder.hide()})),v()(f()(a),"loop",(function(e,t,n){e.forEach((function(e,r,o){e.key===t?n(e,r,o):e.children&&a.loop(e.children,t,n)}))})),v()(f()(a),"loopFilter",(function(e,t){return e.filter((function(e){return e.children&&(e.children=a.loopFilter(e.children,t)),e.key!==t}))})),v()(f()(a),"loopEach",(function(e,t){e.forEach((function(e,n,r){t(e,n,r),e.children&&a.loopEach(e.children,t)}))})),v()(f()(a),"onSaveButtonClick",(function(e){e.preventDefault();var t=a.editFoldersForm.current.getValue("folders");t.selected.length?(a.props.onSaveButtonClickHandler&&"function"==typeof a.props.onSaveButtonClickHandler&&a.props.onSaveButtonClickHandler(t),a.hide()):I.a.notification({message:a.props.i18n._({id:"Please select an item first"}),status:"danger"})})),v()(f()(a),"onRootButtonClick",(function(e){e.preventDefault();var t=a.editFoldersForm.current.getValue("folders");t.selected=[],a.props.onSaveButtonClickHandler&&"function"==typeof a.props.onSaveButtonClickHandler&&a.props.onSaveButtonClickHandler(t),a.hide()})),v()(f()(a),"setTreeValues",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return a.editFoldersForm.current.setValue("folders",{tree:e,selected:t,checked:n})})),v()(f()(a),"onAddTreeItemButtonClick",(function(e){e.preventDefault(),a.dialogFolderEdit.current.show()})),v()(f()(a),"onEditTreeItemButtonClick",(function(e){e.preventDefault();var t,n=a.editFoldersForm.current.getValue("folders");a.loop(n.tree,n.selected[0],(function(e){return t=e})),t&&a.dialogFolderEdit.current.show(t)})),v()(f()(a),"onDeleteTreeItemButtonClick",function(){var e=i()(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),(n=a.editFoldersForm.current.getValue("folders")).checked.map((function(e){return n.tree=a.loopFilter(n.tree,e)})),n.checked=[],n.selected=[],e.next=7,a.editFoldersForm.current.setValue("folders",[]);case 7:return e.next=9,a.editFoldersForm.current.setValue("folders",n);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),v()(f()(a),"onSaveFolderClickHandler",function(){var e=i()(r.a.mark((function e(t){var n,o,i,d,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.editFoldersForm.current.getValue("folders"),a.loop(n.tree,t.key,(function(e){o=e})),delete(i=H()(t)).key,delete i.id,d={data:i,id:t.id,key:t.key},o?a.loop(n.tree,t.key,(function(e){e.data=d.data,e.id=d.id,void 0===e.children&&delete e.children})):n.selected.length?(a.loop(n.tree,n.selected[0],(function(e){l=e})),l.children=l.children||[],l.children.push(d)):n.tree.push(d),n.expanded&&-1===n.expanded.indexOf(t.key)&&n.expanded.push(t.key),a.loopEach(n.tree,(function(e){var t=e.data[Object.keys(P.languages)[0]]?e.data[Object.keys(P.languages)[0]].title:"",n=e.data[a.props.appData.language]?e.data[a.props.appData.language].title:t;e.title=n})),e.next=11,a.editFoldersForm.current.setValue("folders",[]);case 11:return e.next=13,a.editFoldersForm.current.setValue("folders",n);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),v()(f()(a),"getEditForm",(function(e){return F.a.createElement(W,{ref:a.editFoldersForm,prefix:"editFoldersForm",UIkit:I.a,axios:R.a,i18n:e,data:[{id:"folders",type:"tree",draggable:!0,checkable:!0,selectable:!0,addItemButtonLabel:e._({id:"Add"}),editItemButtonLabel:e._({id:"Edit"}),deleteItemButtonLabel:e._({id:"Delete"}),onAddItemButtonClick:function(e){return a.onAddTreeItemButtonClick(e)},onEditItemButtonClick:function(e){return a.onEditTreeItemButtonClick(e)},onDeleteItemButtonClick:function(e){return a.onDeleteTreeItemButtonClick(e)}}],lang:{ERR_VMANDATORY:{id:"Field is required"},ERR_VFORMAT:{id:"Invalid format"},ERR_VNOMATCH:{id:"Passwords do not match"},ERR_LOAD:{id:"Could not load data from server"},ERR_SAVE:{id:"Could not save data"},WILL_BE_DELETED:{id:"will be deleted. Are you sure?"},YES:{id:"Yes"},CANCEL:{id:"Cancel"}}})})),v()(f()(a),"render",(function(){return F.a.createElement("div",null,F.a.createElement(Y,{i18n:a.props.i18n,ref:a.dialogFolderEdit,onSaveButtonClickHandler:a.onSaveFolderClickHandler}),F.a.createElement("div",{id:"dialogFolder_".concat(a.props.id),style:{display:"none"}},F.a.createElement("div",{className:"uk-modal-dialog"},F.a.createElement("div",{className:"uk-modal-body"},a.getEditForm(a.props.i18n)),F.a.createElement("div",{className:"uk-modal-footer uk-text-right"},F.a.createElement("button",{className:"uk-button uk-button-default uk-modal-close uk-margin-small-right",type:"button"},a.props.i18n._({id:"Cancel"})),F.a.createElement("button",{className:"uk-button uk-button-secondary uk-margin-small-right",type:"button",onClick:a.onRootButtonClick},a.props.i18n._({id:"Root"})),F.a.createElement("button",{className:"uk-button uk-button-primary",type:"button",onClick:a.onSaveButtonClick},a.props.i18n._({id:"Select"}))))))})),a.editFoldersForm=F.a.createRef(),a.dialogFolderEdit=F.a.createRef(),a}return g()(t,e),t}(E.Component),q=Object(y.c)((function(e){return{appData:e.appData,appDataRuntime:e.appDataRuntime}}),(function(){return{}}),null,{forwardRef:!0})($),K=Object(E.lazy)((function(){return Promise.all([a.e(0),a.e(1)]).then(a.bind(null,602))})),J=Object(E.lazy)((function(){return Promise.all([a.e(0),a.e(3)]).then(a.bind(null,601))})),Z=function(e){function t(e){var a;return l()(this,t),a=c()(this,p()(t).call(this,e)),v()(f()(a),"state",{loadingError:!1}),v()(f()(a),"componentDidMount",(function(){a.props.appDataRuntime.token||T.b.push("/admin/users/auth?redirect=/admin/pages")})),v()(f()(a),"deauthorize",(function(){a.props.appDataRuntimeSetTokenAction(null),a.props.appDataSetUserAction({}),Object(C.remove)("".concat(P.id,"_auth")),T.b.push("/admin/users/auth?redirect=/admin/pages")})),v()(f()(a),"onPagesTableLoadError",(function(e){e&&403===e.statusCode&&a.deauthorize()})),v()(f()(a),"onSaveSuccessHandler",(function(e,t){if(e&&e.data&&200===e.data.statusCode)I.a.notification({message:t._({id:"Data has been saved successfully"}),status:"success"}),T.b.push("/admin/pages?reload=1");else if(e&&e.data)switch(e.data.errorCode){case 1:I.a.notification({message:t._({id:"Duplicate page, check filename and path"}),status:"danger"});break;default:I.a.notification({message:t._({id:"Could not save a page"}),status:"danger"})}else I.a.notification({message:t._({id:"Could not save a page"}),status:"danger"})})),v()(f()(a),"loadFoldersData",(function(){return new Promise((function(e,t){R.a.post("".concat(L.url,"/api/pages/folders/load"),{token:a.props.appDataRuntime.token,language:a.props.appData.language},{headers:{"content-type":"application/json"}}).then(function(){var a=i()(r.a.mark((function a(n){return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!(n&&n.data&&200===n.data.statusCode&&n.data.data)){a.next=3;break}return e(n.data.data),a.abrupt("return");case 3:t(n);case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()).catch(function(){var e=i()(r.a.mark((function e(n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n&&n.response&&n.response.data&&403===n.response.data.statusCode&&a.deauthorize(),t(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))})),v()(f()(a),"loop",(function(e,t,n){e.forEach((function(e,r,o){e.key!==t?e.children&&a.loop(e.children,t,n):n(e,r,o)}))})),v()(f()(a),"loopPath",(function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return e.forEach((function(e){r.push(e.id),e.key===t?n(e,r):e.children&&a.loopPath(e.children,t,n,r),r.pop()}))})),v()(f()(a),"onSaveFolderHandler",(function(e,t){R.a.post("".concat(L.url,"/api/pages/folders/save"),{token:a.props.appDataRuntime.token,folders:t.tree},{headers:{"content-type":"application/json"}}).then(function(){var t=i()(r.a.mark((function t(a){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a||!a.data||200!==a.data.statusCode){t.next=2;break}return t.abrupt("return");case 2:I.a.notification({message:e._({id:"Could not save data"}),status:"danger"});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch(function(){var t=i()(r.a.mark((function t(n){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n&&n.response&&n.response.data&&403===n.response.data.statusCode)){t.next=3;break}return a.deauthorize(),t.abrupt("return");case 3:I.a.notification({message:e._({id:"Could not save data"}),status:"danger"});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.selected.length?a.loopPath(t.tree,t.selected[0],(function(e,t){return a.editPagesForm.current.setValue("path","/".concat(t.join("/")))})):a.editPagesForm.current.setValue("path","/")})),v()(f()(a),"onSetPathValButtonClick",function(){var e=i()(r.a.mark((function e(t,n){var o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,a.editPagesForm.current.setLoading(!0),e.next=5,a.loadFoldersData();case 5:o=e.sent,a.dialogFolder.current.setTreeValues(o),a.editPagesForm.current.setLoading(!1),a.dialogFolder.current.show(),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(1),a.editPagesForm.current.setLoading(!1),I.a.notification({message:n._({id:"Could not load data from server"}),status:"danger"});case 15:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t,a){return e.apply(this,arguments)}}()),v()(f()(a),"getEditForm",(function(e){return F.a.createElement(J,{ref:a.editPagesForm,prefix:"editPagesForm",UIkit:I.a,axios:R.a,i18n:e,commonFields:["path","filename"],tabs:P.languages,data:[[{id:"title",type:"text",css:"uk-form-width-large",label:"".concat(e._({id:"Title"}),":"),autofocus:!0,helpText:e._({id:"Displayed in browser window"})},{id:"path",type:"val",css:"uk-form-width-medium",label:"".concat(e._({id:"Path"}),":"),defaultValue:"/",onSetValButtonClick:function(t){return a.onSetPathValButtonClick(t,e)}},{id:"filename",type:"text",css:"uk-form-width-medium",label:"".concat(e._({id:"Filename"}),":"),helpText:e._({id:"Latin characters, numbers, _, - (length: 0-64)"})}],{id:"content",type:"ckeditor5",css:"uk-form-width-large",label:"".concat(e._({id:"Content"}),":"),CKEditorInstance:w.a,EditorInstance:x.a,languages:Object.keys(P.languages),language:a.props.appData.language,imageUploadURL:"".concat(L.url,"/api/pages/image/upload"),imageUploadExtras:{token:a.props.appDataRuntime.token}},{id:"divider1",type:"divider"},[{id:"btnCancel",type:"button",buttonType:"link",linkTo:"/admin/pages",css:"uk-button-default uk-margin-small-right",label:e._({id:"Cancel"})},{id:"btnSave",type:"button",buttonType:"submit",css:"uk-button-primary",label:e._({id:"Save"})}]],validation:{title:{mandatory:!0,maxLength:128},path:{mandatory:!0,regexp:/^[a-z0-9_\-\/\/]+$/i,maxLength:128},filename:{regexp:/^[a-z0-9_-]+$/i,maxLength:64}},lang:{ERR_VMANDATORY:{id:"Field is required"},ERR_VFORMAT:{id:"Invalid format"},ERR_VNOMATCH:{id:"Passwords do not match"},ERR_LOAD:{id:"Could not load data from server"},ERR_SAVE:{id:"Could not save data"},WILL_BE_DELETED:{id:"will be deleted. Are you sure?"},YES:{id:"Yes"},CANCEL:{id:"Cancel"}},save:{url:"".concat(L.url,"/api/pages/save"),method:"POST",extras:{id:a.props.match.params.id,token:a.props.appDataRuntime.token}},load:a.props.match.params.id?{url:"".concat(L.url,"/api/pages/load"),method:"POST",extras:{id:a.props.match.params.id,token:a.props.appDataRuntime.token}}:null,onSaveSuccess:function(t){return a.onSaveSuccessHandler(t,e)},onLoadError:function(){return a.setState({loadingError:!0})},onLoadSuccess:function(){return a.setState({loadingError:!1})}})})),v()(f()(a),"reloadEditFormData",(function(e){e.preventDefault(),a.setState({loadingError:!1})})),v()(f()(a),"render",(function(){return F.a.createElement(K,null,F.a.createElement(b.I18n,null,(function(e){var t=e.i18n;return a.props.appDataRuntimeSetDocumentTitleAction(t._(a.props.match.params.id?"Edit Page":"New Page"),a.props.appData.language,a.props.appDataRuntime.config.siteTitle),F.a.createElement(F.a.Fragment,null,F.a.createElement("div",{className:"uk-title-head uk-margin-bottom"},a.props.match.params.id?F.a.createElement(b.Trans,{id:"Edit Page"}):F.a.createElement(b.Trans,{id:"New Page"})),a.state.loadingError?F.a.createElement("div",{className:"uk-alert-danger","uk-alert":"true"},F.a.createElement(b.Trans,{id:"Could not load data from server. Please check your URL or try to <0>reload</0> data.",components:[F.a.createElement("a",{href:"",onClick:a.reloadEditFormData})]})):a.getEditForm(t),F.a.createElement(q,{ref:a.dialogFolder,i18n:t,onSaveButtonClickHandler:function(e){return a.onSaveFolderHandler(t,e)}}))})))})),a.editPagesForm=F.a.createRef(),a.dialogFolder=F.a.createRef(),a}return g()(t,e),t}(E.Component);t.default=Object(y.c)((function(e){return{appData:e.appData,appDataRuntime:e.appDataRuntime,appLingui:e.appLingui}}),(function(e){return{appDataRuntimeSetTokenAction:function(t){return e(Object(B.a)(t))},appDataSetUserAction:function(t){return e(Object(A.a)(t))},appDataRuntimeSetDocumentTitleAction:function(t,a,n){return e(Object(O.a)(t,a,n))}}}))(Z)},599:function(e,t,a){"use strict";var n=a(9);t.a=function(e){return{type:n.c,payload:e}}},600:function(e,t,a){"use strict";var n=a(9);t.a=function(e){return{type:n.e,payload:e}}}}]);